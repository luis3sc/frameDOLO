<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Input Celular</title>
  <link rel="stylesheet" href="./css/frame.css">
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
</head>
<body>
<div class="padsup-1">
    <div class="padhor-1">
        <form class="w100 flex-colum gap1" id="myForm">
            <div>
              <label for="nombre">Nombre</label>
              <div class="mgtp05">
                <input id="nombre" class="padding05 ftsz-1_4 w100 border1px brdclr-g3 border05 inputhover" type="text" required>
                <p class="mgtp05 clr-2" id="nombre-validation"></p> </div>
            </div>
            <div>
              <label for="gmail">Gmail</label>
              <div class="mgtp05">
                <input id="gmail" class="padding05 ftsz-1_4 w100 border1px brdclr-n border05" type="email" required>
                <p class="mgtp05 clr-2" id="gmail-validation"></p> </div>
            </div>
            <div>
              <label for="phone">Celular</label>
              <div class="mgtp05">
                <input class="padding05 mgtp05 ftsz-1_4 w100 border1px brdclr-n border05" id="phone" type="tel" name="phone" required>
                <p class="mgtp05 clr-2" id="validation-message"></p>
              </div>
            </div>
            <div>
              <label for="pais">País</label>
              <div class="mgtp05">
                <input id="pais" class="padding05 ftsz-1_4 w100 border1px brdclr-n border05" type="text" required>
                <p class="mgtp05 clr-2" id="pais-validation"></p> </div>
            </div>
            <div>
              <label for="nombrenegocio">Nombre del Negocio / Marca</label>
              <div class="mgtp05">
                <input id="nombrenegocio" class="padding05 ftsz-1_4 w100 border1px brdclr-n border05" type="text" required>
                <p></p>
              </div>
            </div>
            <div>
              <label for="socialmedia">Enlace de Red Social</label>
              <div class="mgtp05">
                <input id="socialmedia" class="padding05 ftsz-1_4 w100 border1px brdclr-n border05" type="url" required>
                <p></p>
              </div>
            </div>
            <div>
              <label for="socialmedia2">Enlace de Red Social</label>
              <div class="mgtp05">
                <div class="flex-a padding05 w100 ftsz-1_4 border1px brdclr-n border05">
                  <p id="facebook" value="facebook.com/">facebook.com/</p>
                  <input id="socialmedia2" class="h100 ftsz-1_4 winh" type="text" required>
                  <p></p>
                </div>
              </div>
            </div>
            <button class="padding05 mgtp ftsz-1_4 border05 bg-2" type="submit">Enviar datos</button>
          </form>
    </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/html5-validation@1.3.0/dist/polyfill.min.js"></script>
  <script>
    const inputs = document.querySelectorAll(".inputhover");

for (const input of inputs) {
  input.addEventListener("focus", () => {
    input.classList.add("focused");
  });

  input.addEventListener("blur", () => {
    input.classList.remove("focused");
  });
}

    const phoneInputField = document.querySelector("#phone");
const validationMessageElement = document.querySelector("#validation-message");

const allowedCountries = ["ar","cu","co","cr","sv", "ht", "hn", "py","es", "do","pa","pe", "bo", "pr","ni", "gt","br", "ve", "cl", "mx", "us", "ec", "pt","uy"];

const phoneInput = window.intlTelInput(phoneInputField, {
  utilsScript:
    "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
  onlyCountries: allowedCountries,
});

// Función para validar la cantidad de dígitos en el input
function validatePhoneNumber() {
  const fullNumber = phoneInput.getNumber();
  const isValid = fullNumber.length >= 10;

  if (isValid) {
    validationMessageElement.textContent = "";
    phoneInputField.setCustomValidity(""); // Corrected: Set custom validity on the input field
  } else {
    validationMessageElement.textContent = "Número no válido ";
    phoneInputField.setCustomValidity("Número no válido "); // Corrected
  }
}

// Función para enviar mensaje a WhatsApp
function sendDataToWhatsApp() {
    const fullNumber = phoneInput.getNumber()
   const message = generateWhatsAppMessage();
  const encodedMessage = encodeURIComponent(message);
  const whatsappNumber = "51989396941";

  if (fullNumber.length >= 10) {

    const whatsAppLink = `https://api.whatsapp.com/send?phone=${whatsappNumber}&text=${encodedMessage}`;

    window.open(whatsAppLink, "_blank");
  } else {
    alert("El número de teléfono no es válido");
  }
}
function generateWhatsAppMessage() {
const fullNumber = phoneInput.getNumber();
  const nombre = document.getElementById("nombre").value;
  const gmail = document.getElementById("gmail").value;
  const pais = document.getElementById("pais").value;
  const nombrenegocio = document.getElementById("nombrenegocio").value;
  const socialmedia = document.getElementById("socialmedia").value;
  const socialmedia2 = document.getElementById("facebook").textContent + document.getElementById("socialmedia2").value;    
    
	  const message = `¡Hola! Quiero hacer un pedido
	  \n\nDetalles del Pedido:
	  --------------------
	  *Cliente*
	  Nombre: *${nombre}*
      Celular: *${fullNumber}*
	  --------------------
	  *Negocio*
	  Nombre del Negocio: *${nombrenegocio}*
	  Red Social: *${socialmedia}*
	  Facebook: *${socialmedia2}*
	  --------------------
	  --------------------
	  ¡Gracias!`;
	  return message;
	}
// Función para validar la longitud mínima de un campo (reutilizable)
function validateMinLength(inputId, minLength, validationMessageId) {
  const input = document.getElementById(inputId);
  const validationMessage = document.getElementById(validationMessageId);

  if (input.value.length >= minLength) {
    validationMessage.textContent = "";
    input.setCustomValidity("");
  } else {
    validationMessage.textContent = "Falta completar";
    input.setCustomValidity("Longitud mínima: " + minLength + " caracteres");
  }
}

// Agregar evento "submit" al formulario
document.querySelector("#myForm").addEventListener("submit", function(e) {
  e.preventDefault();
  validatePhoneNumber();
  validateMinLength("nombre", 3, "nombre-validation");
  validateMinLength("gmail", 3, "gmail-validation");
  validateMinLength("pais", 3, "pais-validation");
  if (phoneInputField.checkValidity() && document.getElementById("nombre").checkValidity() && document.getElementById("gmail").checkValidity() && document.getElementById("pais").checkValidity()) {
    sendDataToWhatsApp();
  }
});

// Agregar eventos "input" y "blur" a los inputs para la validación
phoneInputField.addEventListener("input", validatePhoneNumber);
phoneInputField.addEventListener("blur", validatePhoneNumber);

document.getElementById("nombre").addEventListener("blur", () => validateMinLength("nombre", 3, "nombre-validation"));
document.getElementById("gmail").addEventListener("blur", () => validateMinLength("gmail", 3, "gmail-validation"));
document.getElementById("pais").addEventListener("blur", () => validateMinLength("pais", 3, "pais-validation"));
  </script>
</body>
</html>
